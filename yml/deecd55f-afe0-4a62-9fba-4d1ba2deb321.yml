Attack_name: LLMNR/NBT-NS Poisoning and SMB Relay
Attack_description: "By responding to LLMNR/NBT-NS network traffic, adversaries may spoof an authoritative source for name resolution to force communication with an adversary controlled system. This activity\
  \ may be used to collect or relay authentication materials. \n\nLink-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are Microsoft Windows components that serve as alternate\
  \ methods of host identification. LLMNR is based upon the Domain Name System (DNS) format and allows hosts on the same local link to perform name resolution for other hosts. NBT-NS identifies systems\
  \ on a local network by their NetBIOS name. (Citation: Wikipedia LLMNR) (Citation: TechNet NetBIOS)\n\nAdversaries can spoof an authoritative source for name resolution on a victim network by responding\
  \ to LLMNR (UDP 5355)/NBT-NS (UDP 137) traffic as if they know the identity of the requested host, effectively poisoning the service so that the victims will communicate with the adversary controlled\
  \ system. If the requested host belongs to a resource that requires identification/authentication, the username and NTLMv2 hash will then be sent to the adversary controlled system. The adversary can\
  \ then collect the hash information sent over the wire through tools that monitor the ports for traffic or through [Network Sniffing](https://attack.mitre.org/techniques/T1040) and crack the hashes offline\
  \ through [Brute Force](https://attack.mitre.org/techniques/T1110) to obtain the plaintext passwords. In some cases where an adversary has access to a system that is in the authentication path between\
  \ systems or when automated scans that use credentials attempt to authenticate to an adversary controlled system, the NTLMv2 hashes can be intercepted and relayed to access and execute code against a\
  \ target system. The relay step can happen in conjunction with poisoning but may also be independent of it. (Citation: byt3bl33d3r NTLM Relaying)(Citation: Secure Ideas SMB Relay)\n\nSeveral tools exist\
  \ that can be used to poison name services within local networks such as NBNSpoof, Metasploit, and [Responder](https://attack.mitre.org/software/S0174). (Citation: GitHub NBNSpoof) (Citation: Rapid7 LLMNR\
  \ Spoofer) (Citation: GitHub Responder)"
guid: deecd55f-afe0-4a62-9fba-4d1ba2deb321
name: LLMNR Poisoning with Inveigh (PowerShell)
tactic:
  - credential-access
  - collection
technique:
  - T1557.001
os:
  - windows
description: Inveigh conducts spoofing attacks and hash/credential captures through both packet sniffing and protocol specific listeners/sockets. This Atomic will run continuously until you cancel it or
  it times out.
executor: powershell
sigma: true
sigma_rule:
  - id: f4bbd493-b796-416e-bbf2-121235348529
    name: win_non_interactive_powershell.yml
  - id: 9fc51a3c-81b3-4fa7-b35f-7c02cf10fd2d
    name: process_creation_susp_web_request_cmd.yml
  - id: 1139d2e2-84b1-4226-b445-354492eba8ba
    name: posh_ps_web_request.yml
  - id: 89819aa4-bbd6-46bc-88ec-c7f7fe30efa6
    name: posh_ps_malicious_commandlets.yml
  - id: f62176f3-8128-4faa-bf6c-83261322e5eb
    name: posh_ps_malicious_keywords.yml
  - id: 1883444f-084b-419b-ac62-e0d0c5b3693f
    name: posh_ps_suspicious_networkcredential.yml
  - id: 03d83090-8cba-44a0-b02f-0b756a050306
    name: posh_ps_accessing_win_api.yml
  - id: 1f21ec3f-810d-4b0e-8045-322202e22b4b
    name: sysmon_powershell_network_connection.yml
  - id: 635dbb88-67b3-4b41-9ea5-a3af2dd88153
    name: sysmon_win_binary_github_com.yml
